App.Services.TrackingActivitiesService=Backbone.View.extend({initialize:function(){this.increaseWebSessions(),this.increaseVisitedWebPages(),this.fillFirstSeenDate(),this.updateAcUtm(),this.updateUserData(),this.checkIfUserIsRegistered(),this.checkIfUserHasCallData()},increaseFieldsByOne:function(e){var a=Cookies.get("activeCampaignContactId"),t=Cookies.get("activeCampaignContactEmail");a&&t&&$.ajax({url:"/"+App.getLang()+"/activeCampaign/increaseByOne",method:"POST",data:{id:a,email:t,fields:e}})},increaseVisitedWebPages:function(){var e=this,a=window.location.pathname;$.each({bootcampJava:{regex:/bootcamp\/java$/,acField:"VISITED_PAGE_BOOTCAMP_JAVA"},bootcampWebdeveloper:{regex:/bootcamp\/webdeveloper$/,acField:"VISITED_PAGE_BOOTCAMP_WEBDEVELOPER"}},function(t,i){i.regex.test(a)&&e.increaseFieldsByOne([i.acField])})},increaseWebSessions:function(){if(void 0===Cookies.get("visited")){if(void 0===Cookies.get("activeCampaignContactId")||void 0===Cookies.get("activeCampaignContactEmail"))return;Cookies.set("visited",!0,{expires:730,path:"/"}),this.increaseFieldsByOne(["WEB_SESSIONS"])}},fillFirstSeenDate:function(){void 0===Cookies.get("firstSeen")&&Cookies.set("firstSeen",$.format.date(new Date,"yyyy-MM-dd HH:mm:ss"),{expires:730,path:"/"})},updateAcUtm:function(){var e,a,t,i=["ac_source","ac_campaign","ac_medium"],o=Cookies.get("activeCampaignContactId"),n=Cookies.get("activeCampaignContactEmail"),s=new Object({});i.forEach(function(i){e=Cookies.get(i),s[i]=o&&n||!e?"":e,(a=App.GetQueryParamByName(i))&&(t=!0,s[i]+=a+" ")});var c=document.referrer;if(""===s.ac_source&&c&&-1===c.indexOf(window.domain)&&(s.ac_source=c+" ",t=!0),o&&n&&t)$.ajax({url:"/"+App.getLang()+"/activeCampaign/updateAcUtm",method:"PUT",data:{id:Cookies.get("activeCampaignContactId"),email:Cookies.get("activeCampaignContactEmail"),acUtm:s},success:function(){i.forEach(function(e){Cookies.remove(e,{path:"/"})})}});else if((!o||!n)&&t)for(var p in s)s[p]&&Cookies.set(p,s[p],{expires:730,path:"/"})},updateUserData:function(){if(void 0===Cookies.get("activeCampaignContactId")||void 0===Cookies.get("activeCampaignContactEmail"))return!1;$.ajax({url:"/"+App.getLang()+"/activeCampaign/updateContact",method:"POST",data:{id:Cookies.get("activeCampaignContactId"),email:Cookies.get("activeCampaignContactEmail"),lastSeen:$.format.date(new Date,"yyyy-MM-dd hh:mm:ss")}})},checkIfUserIsRegistered:function(){return(!0===window.loggedIn||void 0!==Cookies.get("isRegistered"))&&(Cookies.set("isRegistered",!0,{expires:730,path:"/"}),!0)},checkIfUserHasCallData:function(){var e=Cookies.get("callpageData");Cookies.get("activeCampaignContactId")&&Cookies.get("activeCampaignContactEmail")&&e&&this.updateCallpageData(e,Cookies.get("phoneNumber"))},saveCallInfo:function(e,a,t){var i="(Rozmowa um√≥wiona na: "+e+") https://app.callpage.io/calls/call/"+a;Cookies.get("activeCampaignContactId")&&Cookies.get("activeCampaignContactEmail")?this.updateCallpageData(i,t):(Cookies.set("callpageData",i,{expires:730,path:"/"}),Cookies.set("phoneNumber",t,{expires:730,path:"/"}))},updateCallpageData:function(e,a){return $.ajax({url:"/"+App.getLang()+"/activeCampaign/updateContact",method:"POST",data:{id:Cookies.get("activeCampaignContactId"),email:Cookies.get("activeCampaignContactEmail"),callpageCallData:e,phone:a},success:function(){Cookies.remove("callpageData",{path:"/"}),Cookies.remove("phoneNumber",{path:"/"})}})}}),window.trackingActivitiesService=new App.Services.TrackingActivitiesService({el:$("body")});