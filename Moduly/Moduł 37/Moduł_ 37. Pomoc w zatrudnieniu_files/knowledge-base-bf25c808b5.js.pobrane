App.Models.KnowledgeBase=Backbone.Model.extend({$view:function(){return this.get("$view")},hide:function(){this.$view().hide()},show:function(){this.$view().show()}}),App.Collections.KnowledgeBase=Backbone.Collection.extend({url:"/"+App.getLang()+"/knowledge-base-all",model:App.Models.KnowledgeBase}),App.Views.KnowledgeBaseTable=Backbone.View.extend({events:{"change .sort-by-technology":"sortKnowledgeElementByTechnology","change .filter":"filterKnowledgeElements","keyup .search":"searchKnowledgeElements"},initialize:function(e){this.filters={},this.searchText="",this.collection=new App.Collections.KnowledgeBase,this.collection.fetch().done($.proxy(this.render,this))},render:function(){this.$el.find("tbody").append(this.collection.map(function(e){var t=new App.Views.KnowledgeBaseRow({model:e});return e.set("$view",t.$el),t.$el})),this.setStartingSortKnowledgeElementByTechnology()},setStartingSortKnowledgeElementByTechnology:function(){var e=Cookies.get("kb_technology");void 0===e?e=this.$el.find(".sort-by-technology").val():this.$el.find(".sort-by-technology").val(e),this.filters.technology=e,this.clearCheckedSelectOptions(),this.filter(),this.setSelectOptionsByTechnology(),Cookies.set("kb_technology",e,{expires:1e3})},sortKnowledgeElementByTechnology:function(e){var t=$(e.currentTarget).val();this.filters.technology=t,this.clearCheckedSelectOptions(),this.filter(),this.setSelectOptionsByTechnology(),Cookies.set("kb_technology",t,{expires:1e3})},clearCheckedSelectOptions:function(){delete this.filters.type,delete this.filters.category,this.$el.find(".select-by-tech").val("")},setSelectOptionsByTechnology:function(){this.$el.find(".select-by-tech>option").hide(),this.$el.find('.select-by-tech>option[value=""]').show(),this.$el.find('.select-by-tech>option[value^="'+this.filters.technology.toLowerCase()+'_"]').show()},filterKnowledgeElements:function(e){var t=$(e.currentTarget);""===t.val()?delete this.filters[t.attr("name")]:this.filters[t.attr("name")]=t.val(),this.filter()},filter:function(){var e=this;this.collection.invoke("hide");var t=this.collection.where(this.filters);this.searchText.length>=3&&(t=t.filter(function(t){if(t.get("name").toLowerCase().indexOf(e.searchText)>=0||t.get("description").toLowerCase().indexOf(e.searchText)>=0)return t})),(t=new Backbone.Collection(t)).invoke("show"),this.$el.removeClass("tech-html tech-css"),this.$el.addClass("tech-"+this.filters.technology.toLowerCase()),this.$el.find("table td, table th").show(),this.$el.find("table .hide-for-"+this.filters.technology.toLowerCase()).hide()},searchKnowledgeElements:function(e){var t=this;this.searchText=$(e.currentTarget).val().toLowerCase(),clearTimeout(this.searchKnowledgeElementsTimeout),this.searchText.length>=3?this.searchKnowledgeElementsTimeout=setTimeout(function(){t.filter()},500):this.searchKnowledgeElementsTimeout=setTimeout(function(){t.searchText="",t.filter()},500)}}),App.Views.KnowledgeBaseRow=Backbone.View.extend({tagName:"tr",hide:function(){this.$el.hide()},initialize:function(e){this.model=e.model,this.render()},render:function(){this.$el.html(App.Templates("knowledgeBaseRow")(this.model.toJSON()))}});